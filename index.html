<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Company News Dashboard</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        .news-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
        }
        .news-card {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            padding: 20px;
            transition: transform 0.2s ease;
        }
        .news-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        .news-title {
            font-size: 18px;
            margin-top: 0;
        }
        .news-source {
            color: #666;
            font-size: 14px;
            margin-bottom: 10px;
        }
        .company-tag {
            display: inline-block;
            background-color: #e0f7fa;
            color: #006064;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }
        .news-date {
            color: #888;
            font-size: 12px;
            margin-top: 10px;
        }
        .timestamp {
            text-align: center;
            color: #999;
            font-size: 12px;
            margin-top: 40px;
        }
        a {
            color: #0066cc;
            text-decoration: none;
        }
        a:hover {
            text-decoration: underline;
        }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        /* Image thumbnail styles */
        .news-image {
            margin-bottom: 15px;
            max-height: 180px;
            overflow: hidden;
            border-radius: 6px;
        }
        .news-image img {
            width: 100%;
            height: 180px;
            object-fit: cover;
            display: block;
            transition: transform 0.3s ease;
        }
        .news-card:hover .news-image img {
            transform: scale(1.05);
        }
        
        /* Chatbot styles */
        .chatbot-container {
            position: fixed;
            top: 20px; /* Changed from bottom to top */
            right: 20px;
            width: 350px;
            height: calc(100vh - 40px); /* Changed to take up almost full viewport height */
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 5px 25px rgba(0,0,0,0.2);
            display: flex;
            flex-direction: column;
            z-index: 1000;
            transition: transform 0.3s ease, opacity 0.3s ease;
            transform: translateX(110%); /* Changed from translateY to translateX */
            opacity: 0;
            overflow: hidden; /* Added to ensure no overflow */
        }
        
        .chatbot-container.active {
            transform: translateX(0); /* Changed from translateY to translateX */
            opacity: 1;
        }
        
        .chatbot-header {
            background-color: #0066cc;
            color: white;
            padding: 15px;
            border-radius: 10px 10px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .chatbot-title {
            font-weight: bold;
            margin: 0;
        }
        
        .chatbot-messages {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            max-height: calc(100vh - 140px); /* Added to ensure scrolling works properly */
        }
        
        .message {
            margin-bottom: 10px;
            max-width: 80%;
            padding: 10px 15px;
            border-radius: 18px;
            line-height: 1.4;
        }
        
        .user-message {
            align-self: flex-end;
            background-color: #0066cc;
            color: white;
        }
        
        .bot-message {
            align-self: flex-start;
            background-color: #f1f1f1;
        }
        
        .chatbot-input {
            display: flex;
            padding: 10px;
            border-top: 1px solid #e0e0e0;
        }
        
        .chatbot-input input {
            flex: 1;
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 20px;
            outline: none;
        }
        
        .chatbot-input button {
            background-color: #0066cc;
            color: white;
            border: none;
            border-radius: 20px;
            padding: 10px 15px;
            margin-left: 10px;
            cursor: pointer;
        }
        
        .chat-toggle-button {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 60px;
            height: 60px;
            background-color: #0066cc;
            color: white;
            border: none;
            border-radius: 50%;
            display: none; /* Changed from flex to none to hide initially */
            justify-content: center;
            align-items: center;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            z-index: 1001;
            opacity: 1;
            visibility: visible;
        }
        
        /* Adding a pulsing animation to make the chat button more noticeable */
        @keyframes pulse {
            0% { transform: scale(1); box-shadow: 0 4px 8px rgba(0,0,0,0.2); }
            50% { transform: scale(1.05); box-shadow: 0 8px 16px rgba(0,0,0,0.3); }
            100% { transform: scale(1); box-shadow: 0 4px 8px rgba(0,0,0,0.2); }
        }
        
        .chat-toggle-button {
            animation: pulse 2s infinite;
        }
        
        .chat-toggle-button:hover {
            background-color: #0055bb;
        }

        .source-citation {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
            font-style: italic;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Company News Dashboard</h1>
    </div>
    
    <div class="news-grid">

    <div class="news-card">
        <span class="company-tag">Unaliwear</span>
        
        <h3 class="news-title"><a href="https://www.consumeraffairs.com/medical-alert-systems/unaliwear-kanega-watch.html" target="_blank">UnaliWear Kanega Watch Reviews</a></h3>
        <div class="news-source">ConsumerAffairs</div>
        <p>If any issues come up, UnaliWear will replace the watch for free. The company also covers replacement and shipping at no cost the first time you break the watch. Be aware that UnaliWear does not ...</p>
        <div class="news-date">2025-03-24T00:01:00+00:00</div>
    </div>
    
    <div class="news-card">
        <span class="company-tag">BrainCheck</span>
        
        <h3 class="news-title"><a href="#" target="_blank">No recent news found for BrainCheck</a></h3>
        <div class="news-source">System</div>
        <p>No content available</p>
        <div class="news-date">2025-04-19</div>
    </div>
    
    <div class="news-card">
        <span class="company-tag">Dermala</span>
        
        <h3 class="news-title"><a href="#" target="_blank">No recent news found for Dermala</a></h3>
        <div class="news-source">System</div>
        <p>No content available</p>
        <div class="news-date">2025-04-19</div>
    </div>
    
    <div class="news-card">
        <span class="company-tag">Oralucent</span>
        
        <h3 class="news-title"><a href="#" target="_blank">No recent news found for Oralucent</a></h3>
        <div class="news-source">System</div>
        <p>No content available</p>
        <div class="news-date">2025-04-19</div>
    </div>
    
    <div class="news-card">
        <span class="company-tag">Flowly</span>
        
        <h3 class="news-title"><a href="#" target="_blank">No recent news found for Flowly</a></h3>
        <div class="news-source">System</div>
        <p>No content available</p>
        <div class="news-date">2025-04-19</div>
    </div>
    
    <div class="news-card">
        <span class="company-tag">Rosy</span>
        <div class="news-image"><img src="https://www.bing.com/th?id=ORMS.694f9973ff025284076925a66f7a820b&amp;pid=Wdp" alt="A Lancaster-based ATM group collapsed after painting a rosy outlook to investors and small-business owners"></div>
        <h3 class="news-title"><a href="https://www.msn.com/en-us/money/companies/a-lancaster-based-atm-group-collapsed-after-painting-a-rosy-outlook-to-investors-and-small-business-owners/ar-AA1vFZQt" target="_blank">A Lancaster-based ATM group collapsed after painting a rosy outlook to investors and small-business owners</a></h3>
        <div class="news-source">Philadelphia Inquirer</div>
        <p>Contrary to that rosy outlook, the company defaulted on $138 million in payments to its investors last month, and its suppliers started removing currency from Paramount machines. As a result ...</p>
        <div class="news-date">2024-12-11T15:59:00+00:00</div>
    </div>
    
    <div class="news-card">
        <span class="company-tag">Rosy</span>
        
        <h3 class="news-title"><a href="https://www.marketwatch.com/story/groupe-dynamite-shares-rise-on-4q-beat-rosy-outlook-3d5ac9e1" target="_blank">Groupe Dynamite Shares Rise on 4Q Beat, Rosy Outlook</a></h3>
        <div class="news-source">MarketWatch</div>
        <p>Groupe Dynamite shares rose after the company reported better-than-expected revenue and profit in the fourth quarter of what it called a breakthrough year. Shares traded 4.7% higher at 12.12 Canadian dollars ($8.73).</p>
        <div class="news-date">2025-04-15T14:26:00+00:00</div>
    </div>
    
    <div class="news-card">
        <span class="company-tag">De Oro Devices</span>
        
        <h3 class="news-title"><a href="#" target="_blank">No recent news found for De Oro Devices</a></h3>
        <div class="news-source">System</div>
        <p>No content available</p>
        <div class="news-date">2025-04-19</div>
    </div>
    
    <div class="news-card">
        <span class="company-tag">Partum Health</span>
        
        <h3 class="news-title"><a href="#" target="_blank">No recent news found for Partum Health</a></h3>
        <div class="news-source">System</div>
        <p>No content available</p>
        <div class="news-date">2025-04-19</div>
    </div>
    
    <div class="news-card">
        <span class="company-tag">Fort Health</span>
        
        <h3 class="news-title"><a href="https://www.msn.com/en-us/public-safety-and-emergencies/health-and-safety-alerts/fort-bend-co-health-officials-confirm-first-case-of-measles-in-area-linked-to-international-travel/ar-AA1BWPEp" target="_blank">Fort Bend Co. health officials confirm first case of measles in area linked to international travel</a></h3>
        <div class="news-source">MSN</div>
        <p>The Fort Bend County Health and Human Services confirmed its first case of measles in the county on Sunday. According to a press release, the case involves a 50- to 60-year-old woman who was ...</p>
        <div class="news-date">2025-03-30T16:31:00+00:00</div>
    </div>
    
    <div class="news-card">
        <span class="company-tag">Fort Health</span>
        
        <h3 class="news-title"><a href="https://www.mobihealthnews.com/tag/fort-health" target="_blank">Fort Health</a></h3>
        <div class="news-source">MobiHealthNews</div>
        <p>allowing Fort Health to rapidly train its therapists using evidence-based therapeutic protocols, which may lead to... Digital obsessive-compulsive disorder (OCD) identification and management platform NOCD closed a $35 million funding round co-led by Cigna ...</p>
        <div class="news-date">2023-02-08T00:00:00+00:00</div>
    </div>
    
    <div class="news-card">
        <span class="company-tag">RubyWell</span>
        
        <h3 class="news-title"><a href="#" target="_blank">No recent news found for RubyWell</a></h3>
        <div class="news-source">System</div>
        <p>No content available</p>
        <div class="news-date">2025-04-19</div>
    </div>
    
    <div class="news-card">
        <span class="company-tag">Atlantic Sea Farms</span>
        
        <h3 class="news-title"><a href="#" target="_blank">No recent news found for Atlantic Sea Farms</a></h3>
        <div class="news-source">System</div>
        <p>No content available</p>
        <div class="news-date">2025-04-19</div>
    </div>
    
    <div class="news-card">
        <span class="company-tag">VidaFuel</span>
        
        <h3 class="news-title"><a href="#" target="_blank">No recent news found for VidaFuel</a></h3>
        <div class="news-source">System</div>
        <p>No content available</p>
        <div class="news-date">2025-04-19</div>
    </div>
    
    </div>
    <p class="timestamp">Last updated: 2025-04-19T04:34:24.670257+00:00</p>
    
    <!-- Chatbot UI - Added title attribute and more visible text -->
    <button class="chat-toggle-button" title="Open Chat Assistant">ðŸ’¬</button>
    <div class="chatbot-container">
        <div class="chatbot-header">
            <span class="chatbot-title">News Assistant</span>
            <span class="close-chat" style="cursor: pointer;">âœ•</span>
        </div>
        <div class="chatbot-messages">
            <div class="message bot-message">
                Hi! I'm your news assistant. Ask me anything about the news articles on this page.
            </div>
        </div>
        <div class="chatbot-input">
            <input type="text" placeholder="Ask a question...">
            <button>Send</button>
        </div>
    </div>
    
    <script>
        // Store news data for the chatbot
        const newsData = [{"company": "Unaliwear", "title": "UnaliWear Kanega Watch Reviews", "url": "https://www.consumeraffairs.com/medical-alert-systems/unaliwear-kanega-watch.html", "source": "ConsumerAffairs", "body": "If any issues come up, UnaliWear will replace the watch for free. The company also covers replacement and shipping at no cost the first time you break the watch. Be aware that UnaliWear does not ...", "date": "2025-03-24T00:01:00+00:00", "full_content": "Content extraction failed: 403 Client Error: Forbidden for url: https://www.consumeraffairs.com/medical-alert-systems/unaliwear-kanega-watch.html", "extraction_status": "success"}, {"company": "BrainCheck", "title": "No recent news found for BrainCheck", "url": "#", "source": "System", "body": "No content available", "date": "2025-04-19", "full_content": "", "extraction_status": "not_attempted"}, {"company": "Dermala", "title": "No recent news found for Dermala", "url": "#", "source": "System", "body": "No content available", "date": "2025-04-19", "full_content": "", "extraction_status": "not_attempted"}, {"company": "Oralucent", "title": "No recent news found for Oralucent", "url": "#", "source": "System", "body": "No content available", "date": "2025-04-19", "full_content": "", "extraction_status": "not_attempted"}, {"company": "Flowly", "title": "No recent news found for Flowly", "url": "#", "source": "System", "body": "No content available", "date": "2025-04-19", "full_content": "", "extraction_status": "not_attempted"}, {"company": "Rosy", "title": "A Lancaster-based ATM group collapsed after painting a rosy outlook to investors and small-business owners", "url": "https://www.msn.com/en-us/money/companies/a-lancaster-based-atm-group-collapsed-after-painting-a-rosy-outlook-to-investors-and-small-business-owners/ar-AA1vFZQt", "source": "Philadelphia Inquirer", "body": "Contrary to that rosy outlook, the company defaulted on $138 million in payments to its investors last month, and its suppliers started removing currency from Paramount machines. As a result ...", "date": "2024-12-11T15:59:00+00:00", "full_content": "Note: Content could not be properly extracted from this source. Using summary instead.\n\nContrary to that rosy outlook, the company defaulted on $138 million in payments to its investors last month, and its suppliers started removing currency from Paramount machines. As a result ...", "extraction_status": "content_too_short"}, {"company": "Rosy", "title": "Groupe Dynamite Shares Rise on 4Q Beat, Rosy Outlook", "url": "https://www.marketwatch.com/story/groupe-dynamite-shares-rise-on-4q-beat-rosy-outlook-3d5ac9e1", "source": "MarketWatch", "body": "Groupe Dynamite shares rose after the company reported better-than-expected revenue and profit in the fourth quarter of what it called a breakthrough year. Shares traded 4.7% higher at 12.12 Canadian dollars ($8.73).", "date": "2025-04-15T14:26:00+00:00", "full_content": "Content extraction failed: 401 Client Error: HTTP Forbidden for url: https://www.marketwatch.com/story/groupe-dynamite-shares-rise-on-4q-beat-rosy-outlook-3d5ac9e1", "extraction_status": "success"}, {"company": "De Oro Devices", "title": "No recent news found for De Oro Devices", "url": "#", "source": "System", "body": "No content available", "date": "2025-04-19", "full_content": "", "extraction_status": "not_attempted"}, {"company": "Partum Health", "title": "No recent news found for Partum Health", "url": "#", "source": "System", "body": "No content available", "date": "2025-04-19", "full_content": "", "extraction_status": "not_attempted"}, {"company": "Fort Health", "title": "Fort Bend Co. health officials confirm first case of measles in area linked to international travel", "url": "https://www.msn.com/en-us/public-safety-and-emergencies/health-and-safety-alerts/fort-bend-co-health-officials-confirm-first-case-of-measles-in-area-linked-to-international-travel/ar-AA1BWPEp", "source": "MSN", "body": "The Fort Bend County Health and Human Services confirmed its first case of measles in the county on Sunday. According to a press release, the case involves a 50- to 60-year-old woman who was ...", "date": "2025-03-30T16:31:00+00:00", "full_content": "Note: Content could not be properly extracted from this source. Using summary instead.\n\nThe Fort Bend County Health and Human Services confirmed its first case of measles in the county on Sunday. According to a press release, the case involves a 50- to 60-year-old woman who was ...", "extraction_status": "content_too_short"}, {"company": "Fort Health", "title": "Fort Health", "url": "https://www.mobihealthnews.com/tag/fort-health", "source": "MobiHealthNews", "body": "allowing Fort Health to rapidly train its therapists using evidence-based therapeutic protocols, which may lead to... Digital obsessive-compulsive disorder (OCD) identification and management platform NOCD closed a $35 million funding round co-led by Cigna ...", "date": "2023-02-08T00:00:00+00:00", "full_content": "Content extraction failed: 403 Client Error: Forbidden for url: https://www.mobihealthnews.com/tag/fort-health", "extraction_status": "success"}, {"company": "RubyWell", "title": "No recent news found for RubyWell", "url": "#", "source": "System", "body": "No content available", "date": "2025-04-19", "full_content": "", "extraction_status": "not_attempted"}, {"company": "Atlantic Sea Farms", "title": "No recent news found for Atlantic Sea Farms", "url": "#", "source": "System", "body": "No content available", "date": "2025-04-19", "full_content": "", "extraction_status": "not_attempted"}, {"company": "VidaFuel", "title": "No recent news found for VidaFuel", "url": "#", "source": "System", "body": "No content available", "date": "2025-04-19", "full_content": "", "extraction_status": "not_attempted"}];
        
        // Debug flag - set to true to see debug info in console
        const DEBUG = true;
        
        // Chatbot functionality
        document.addEventListener('DOMContentLoaded', () => {
            const chatToggle = document.querySelector('.chat-toggle-button');
            const chatContainer = document.querySelector('.chatbot-container');
            const closeChat = document.querySelector('.close-chat');
            const chatInput = document.querySelector('.chatbot-input input');
            const sendButton = document.querySelector('.chatbot-input button');
            const messagesContainer = document.querySelector('.chatbot-messages');
            
            // Automatically open the chatbot on page load
            setTimeout(() => {
                chatContainer.classList.add('active');
                chatToggle.style.display = 'none';
                chatInput.focus(); // Focus on the input field
            }, 1000); // Short delay to ensure page has loaded
            
            // Toggle chat open/close
            chatToggle.addEventListener('click', () => {
                chatContainer.classList.add('active');
                chatToggle.style.display = 'none';
                chatInput.focus();
            });
            
            closeChat.addEventListener('click', () => {
                chatContainer.classList.remove('active');
                setTimeout(() => {
                    chatToggle.style.display = 'flex'; // Show toggle button after transition
                }, 300);
            });
            
            // Send message function
            function sendMessage() {
                const question = chatInput.value.trim();
                if (!question) return;
                
                // Add user message to chat
                addMessage(question, 'user');
                chatInput.value = '';
                
                // Check if this is a follow-up response
                if (handleFollowUp(question)) {
                    // If it was handled as a follow-up, we're done
                    return;
                }
                
                // Otherwise process as a new query
                conversationState.currentQuery = question;
                conversationState.mode = 'showing_results';
                conversationState.currentArticleIndex = 0;
                processQuery(question);
            }
            
            // Add message to chat
            function addMessage(text, sender) {
                const message = document.createElement('div');
                message.classList.add('message');
                message.classList.add(sender + '-message');
                message.textContent = text;
                messagesContainer.appendChild(message);
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            }
            
            // Add message with citation
            function addMessageWithCitation(text, citation) {
                const messageContainer = document.createElement('div');
                
                const message = document.createElement('div');
                message.classList.add('message');
                message.classList.add('bot-message');
                message.textContent = text;
                
                const citationElement = document.createElement('div');
                citationElement.classList.add('source-citation');
                citationElement.textContent = 'Source: ' + citation;
                
                messageContainer.appendChild(message);
                messageContainer.appendChild(citationElement);
                messagesContainer.appendChild(messageContainer);
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            }
            
            // Enhanced RAG implementation with full content
            function processQuery(question) {
                // Convert question to lowercase for case-insensitive matching
                const lowerQuestion = question.toLowerCase();
                
                if (DEBUG) {
                    console.log('Processing query:', question);
                    console.log('Available articles:', newsData.length);
                }
                
                // Improved keyword extraction
                let keywords = [];
                
                // First extract quoted phrases
                const quoteRegex = /"([^"]+)"/g;
                let quoteMatch;
                while ((quoteMatch = quoteRegex.exec(question)) !== null) {
                    keywords.push(quoteMatch[1].toLowerCase());
                }
                
                // Then extract individual important words (excluding common stop words)
                const stopWords = new Set([
                    'a', 'an', 'the', 'and', 'or', 'but', 'is', 'are', 'was', 'were', 
                    'to', 'of', 'in', 'on', 'at', 'by', 'for', 'with', 'about', 'from',
                    'these', 'those', 'this', 'that', 'have', 'has', 'had', 'do', 'does',
                    'did', 'can', 'could', 'will', 'would', 'should', 'may', 'might'
                ]);
                
                const wordKeywords = lowerQuestion
                    .replace(/[^a-zA-Z0-9 ]/g, ' ')
                    .split(' ')
                    .filter(word => word.length > 2 && !stopWords.has(word.toLowerCase()));
                    
                keywords = [...keywords, ...wordKeywords];
                
                if (DEBUG) {
                    console.log('Extracted keywords:', keywords);
                }
                
                // Search for relevant articles
                let relevantArticles = [];
                newsData.forEach(article => {
                    let score = 0;
                    const title = article.title.toLowerCase();
                    const body = article.body.toLowerCase();
                    const fullContent = article.full_content ? article.full_content.toLowerCase() : '';
                    
                    // Check for direct question matches in content
                    if (fullContent && fullContent.includes(lowerQuestion)) {
                        score += 10; // Large boost for exact question match
                    }
                    
                    // Check if keywords are in title, body or full content
                    keywords.forEach(keyword => {
                        // Check for exact matches first
                        if (title.includes(keyword)) score += 5;  // Title matches are weighted highest
                        if (body.includes(keyword)) score += 3;   // Summary matches are important
                        
                        if (fullContent) {
                            // For longer keywords (phrases), boost the score even more
                            if (keyword.length > 10 && fullContent.includes(keyword)) {
                                score += 8;
                            } else if (fullContent.includes(keyword)) {
                                score += 2;  // Full content matches
                            }
                            
                            // Count occurrences for additional scoring
                            const keywordRegex = new RegExp(keyword, 'gi');
                            const occurrences = (fullContent.match(keywordRegex) || []).length;
                            score += Math.min(occurrences, 5) * 0.5; // Cap at 2.5 points from occurrences
                        }
                    });
                    
                    // Special handling for specific question types
                    if (lowerQuestion.includes('who') || lowerQuestion.includes('person')) {
                        // Person entity detection
                        const nameRegex = /([A-Z][a-z]+ [A-Z][a-z]+)/g;
                        const names = fullContent ? (fullContent.match(nameRegex) || []) : [];
                        if (names.length > 0) score += 2;
                    }
                    
                    if (score > 0) {
                        if (DEBUG) {
                            console.log(`Article: ${article.title}, Score: ${score}`);
                        }
                        relevantArticles.push({...article, score});
                    }
                });
                
                // Sort by relevance
                relevantArticles.sort((a, b) => b.score - a.score);
                
                // Store in conversation state
                conversationState.relevantArticles = relevantArticles;
                conversationState.currentArticleIndex = 0;
                
                if (DEBUG) {
                    console.log('Relevant articles found:', relevantArticles.length);
                    if (relevantArticles.length > 0) {
                        console.log('Top article:', relevantArticles[0].title);
                        console.log('Top score:', relevantArticles[0].score);
                    }
                }
                
                // Generate response based on findings
                if (relevantArticles.length > 0) {
                    const mostRelevant = relevantArticles[0];
                    let response = "";
                    
                    // Extract the most relevant snippet from full content if available
                    let informativeSnippet = '';
                    if (mostRelevant.full_content) {
                        const fullContent = mostRelevant.full_content;
                        
                        // Improved paragraph extraction
                        // First split by clear paragraph breaks
                        const paragraphs = fullContent.split(/\n+/)
                            .filter(p => p.trim().length > 50);
                        
                        // If no paragraphs found, create them from sentences
                        let foundRelevantSnippet = false;
                        
                        // First look for paragraphs containing multiple keywords
                        for (const paragraph of paragraphs) {
                            const lowerPara = paragraph.toLowerCase();
                            const matchedKeywords = keywords.filter(kw => lowerPara.includes(kw));
                            
                            if (matchedKeywords.length >= 2) {
                                informativeSnippet = paragraph.trim().substring(0, 300) + '...';
                                foundRelevantSnippet = true;
                                break;
                            }
                        }
                        
                        // If no multi-keyword paragraph, look for any keyword match
                        if (!foundRelevantSnippet) {
                            for (const paragraph of paragraphs) {
                                if (keywords.some(keyword => paragraph.toLowerCase().includes(keyword))) {
                                    informativeSnippet = paragraph.trim().substring(0, 300) + '...';
                                    foundRelevantSnippet = true;
                                    break;
                                }
                            }
                        }
                        
                        // If still no good paragraph found, just take an interesting part of the content
                        if (!foundRelevantSnippet && fullContent.length > 0) {
                            // If we have substantial content, try to find the most interesting part
                            if (fullContent.length > 500) {
                                // Look for a part that might be from the middle of the article
                                const middleStart = Math.floor(fullContent.length / 3);
                                const middleContent = fullContent.substring(middleStart, middleStart + 500);
                                const sentences = middleContent.split(/[.!?] /).filter(s => s.length > 30);
                                
                                if (sentences.length > 0) {
                                    informativeSnippet = sentences[0].trim() + '...';
                                } else {
                                    informativeSnippet = fullContent.substring(0, 300) + '...';
                                }
                            } else {
                                informativeSnippet = fullContent.substring(0, 300) + '...';
                            }
                        }
                    }
                    
                    // Generate different responses based on question type
                    if (lowerQuestion.includes('what') && lowerQuestion.includes('company')) {
                        response = `Based on the news, ${mostRelevant.company} has been mentioned in relation to: "${mostRelevant.title}"`;
                    } else if (lowerQuestion.includes('latest') || lowerQuestion.includes('recent')) {
                        response = `The latest news I found is: "${mostRelevant.title}". ${mostRelevant.body.substring(0, 150)}...`;
                    } else if (informativeSnippet) {
                        // Use the full content snippet for detailed answers
                        response = `According to ${mostRelevant.source}: "${informativeSnippet}"`;
                    } else {
                        response = `I found this relevant information: "${mostRelevant.title}". ${mostRelevant.body.substring(0, 150)}...`;
                    }
                    
                    addMessageWithCitation(response, `${mostRelevant.source}, ${mostRelevant.date} - ${mostRelevant.url}`);
                    
                    // If there are more relevant articles, mention them
                    if (relevantArticles.length > 1) {
                        setTimeout(() => {
                            addMessage(`I also found ${relevantArticles.length - 1} more articles that might be relevant. Would you like to know more about any specific topic?`, 'bot');
                            conversationState.mode = 'offering_more'; // Set mode to offering more articles
                        }, 1000);
                    }
                } else {
                    addMessage(`I couldn't find any information about that in the current news articles. Could you try asking something else?`, 'bot');
                    conversationState.mode = 'initial'; // Reset mode
                }
            }
            
            // Conversation state to track dialogue context
            const conversationState = {
                mode: 'initial', // 'initial', 'showing_results', 'offering_more'
                currentQuery: '',
                relevantArticles: [],
                currentArticleIndex: 0
            };
            
            // Handle follow-up responses (yes/no)
            function handleFollowUp(response) {
                const lowerResponse = response.toLowerCase().trim();
                
                if (conversationState.mode === 'offering_more' && 
                    (lowerResponse === 'yes' || lowerResponse === 'sure' || 
                     lowerResponse === 'ok' || lowerResponse.includes('yes'))) {
                    
                    // Show next article from previously found relevant articles
                    if (conversationState.relevantArticles.length > conversationState.currentArticleIndex + 1) {
                        conversationState.currentArticleIndex++;
                        const nextArticle = conversationState.relevantArticles[conversationState.currentArticleIndex];
                        
                        let response = '';
                        if (nextArticle.full_content) {
                            const snippet = nextArticle.full_content.substring(0, 300) + '...';
                            response = `Here's another relevant article from ${nextArticle.source}: "${snippet}"`;
                        } else {
                            response = `Here's another relevant article: "${nextArticle.title}". ${nextArticle.body.substring(0, 150)}...`;
                        }
                        
                        addMessageWithCitation(response, `${nextArticle.source}, ${nextArticle.date} - ${nextArticle.url}`);
                        
                        // If there are still more articles, offer again
                        const remaining = conversationState.relevantArticles.length - conversationState.currentArticleIndex - 1;
                        if (remaining > 0) {
                            setTimeout(() => {
                                addMessage(`I have ${remaining} more articles that might interest you. Would you like to see another one?`, 'bot');
                                // Stay in offering_more mode
                            }, 1000);
                        } else {
                            setTimeout(() => {
                                addMessage(`That's all the relevant articles I found. Is there something else you'd like to know about?`, 'bot');
                                conversationState.mode = 'initial'; // Reset mode
                            }, 1000);
                        }
                        return true; // Handled
                    }
                }
                
                // If response wasn't handled as a follow-up
                return false;
            }
            
            // Event listeners for sending messages
            sendButton.addEventListener('click', sendMessage);
            chatInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') sendMessage();
            });
            
            // Make sure chat toggle is visible on page load
            chatToggle.style.display = 'none'; // Keep it hidden since we're auto-opening
            chatToggle.style.opacity = '1';
            
            // Add a timeout to make the chatbot button pulse after a short delay
            setTimeout(() => {
                chatToggle.classList.add('attention');
            }, 2000);
        });
    </script>
</body>
</html>
